- synchronized
  - 偏向锁的释放
    - 全局安全点（在这个时间点上没有正在执行的字节码）
    - 先暂停拥有偏向锁的线程，然后检查持有偏向锁的线程是否活着
    - 线程不处于活动状态，则将对象头设置成无锁状态
    - 如果线程仍然活着，拥有偏向锁的栈会被执行，遍历偏向对象的锁记录，栈中的锁记录和对象头的Mark Word要么重新偏向于其他线程，要么恢复到无锁或者升级为偏向锁(原来的线程仍然需要持有偏向锁)，最后唤醒暂停的线程
  - 轻量级锁
    - Displaced Mark Word：线程在执行同步块之前，JVM会先在**当前线程的栈桢**中创建**用于存储锁记录的空间**，并将对象头中的Mark Word复制到锁记录中
    - 然后线程尝试使用**CAS将对象头中的Mark Word替换为指向锁记录的指针**
    - CAS失败则自旋
    - 自旋失败后就膨胀为重量级锁
  - 膨胀对比
    - 偏向锁冲突，两者都升级为轻量级锁
    - 轻量级膨胀为重量级锁：竞争失败而且自旋未获得锁的一方膨胀为重量级锁并阻塞(等待成功的一方唤醒自己)，成功一方在释放时候notify
  - mark word对比
    - 无锁：对象的hashCode \+ 对象分代年龄 \+ 无锁标记
    - 偏向锁：线程ID \+ Epoch \+ 对象分代年龄 \+ 偏向锁标记
    - 轻量级锁：**指向栈中锁记录的指针** \+ 轻量级锁标记
    - 重量级锁：**指向互斥量（重量级锁）的指针**  \+ 重量级锁标记
    - GC：空 \+ GC锁标记
