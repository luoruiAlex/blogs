### 分配流程
- 1.通过逃逸分析，确定对象是在栈上分配还是在堆上分配，如果没有逃逸，则在栈上分配
  - 非逃逸小对象(线程独享的对象)
- 2.TLAB(Thread Local Allocation Buffer)
  - 每个线程从Eden分配一大块空间作为TLAB
  - 当一个Java线程在自己的TLAB中分配到尽头之后，再要分配就会出发一次“TLAB refill”，也就是说之前自己的TLAB就“不管了”（所有权交回给共享的Eden），然后重新从Eden里分配一块空间作为新的TLAB
  - 到触发GC的时候，无论是minor GC还是full GC，要收集Eden的时候里面的空间无论是属于某个线程的TLAB还是不属于任何TLAB都一视同仁，把Eden当作一个整体来收集里面的对象
  - TLAB中的对象可以共享
- 3.尝试直接进入老年代
- 4.分配给eden中的其他区域

### 分配规则
- 1.优先分配在Eden(如果Eden空间不够，则执行一次MinorGC)
- 2.大对象直接进入老年代
- 3.长期存活的对象进入老年代
- 4.动态判断对象的年龄：Survivor中某个年龄的对象占了Survivor内存的一半以上，则年龄大于等于该年龄的对象进入老年代
- 5.空间分配担保：Minor GC时，如果老年代不够容纳Survivor移至老年代的对象的*平均大小*，则进行一次Full GC
