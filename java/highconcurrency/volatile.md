### 作用
- 保证可见性，不保证原子性
- 禁止指令重排

## 保证可见性
- 写操作：JVM会向处理器发送一条Lock前缀的指令，变量刷入主内存
- 读操作：每个处理会通过嗅探在总线上传播的数据来检查 自己的缓存是否过期，当处理器发现自己缓存行对应的内存地址被修改了，就会将当前处理器的缓存行设置成无效状态

### 指令重排
- 分类
  - 编译器重排：不改变单线程程序语义
  - 处理器重排：前提是不存在数据依赖
- 效果
  - 提升了性能
  - 影响多线程执行的正确性
  
### 禁止指令重排
- happens-before：对volatile变量的写操作happens-before后续的操作
- volatile：Lock前缀指令实际上相当于一个内存屏障（也成内存栅栏），它确保指令重排序时不会把其后面的指令排到内存屏障之前的位置，也不会把前面的指令排到内存屏障的后面

### 其他
- volatile的内存屏障插入策略非常保守，其实在实际中，只要不改变volatile**写-读**的内存语义，编译器可以根据具体情况优化，省略不必要的屏障
