### 进程内缓存
- 优点：节省带宽、响应时延更低
- 缺点：一致性难以保障，违背了分层架构设计的无状态准则
- 一致性方案
  - 单节点通知其他节点
  - MQ通知其他节点
  - 每个节点定时从后端拉最新的数据
- 适用场景
  - 只读数据
  - 及其高并发，例如秒杀
  - 一定程度上允许数据不一致的业务
  
### redis、memcache
- 复杂数据结构适用redis
- 不要把redis当做DB和MQ使用
- redis天然支持高可用
- memcache的value最大1M，更大的只能用redis
- mc使用预分配内存池的方式管理内存，redis临时分配
- mc多线程，redis单线程

### 使用策略
- 应该淘汰缓存，而不是更新缓存(更新缓存可能重复计算甚至并发时数据不一致)
- 淘汰操作时序
  - 先操作数据库，可避免并发读写数据不一致
  - 先淘汰缓存，避免原子性被破坏时数据不一致
- 写后立刻读，脏数据入缓存
  - 主从数据库同步完成之前，读从库把旧数据存入缓存，即主从不一致导致的问题
  - 应对策略：
    - 忽略
    - 强制读写都落在主库上，通过缓存来提升读性能
    - 选择性读主：cache里面记录哪些记录发生过写请求
