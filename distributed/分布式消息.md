### 网络请求
- 网络通信包含**成功、失败、超时**三种情况
  - 成功、失败：目标节点正确、流量不能被中间代理丢包才能得到**确定的**响应结果(成功、失败)
  - 超时：请求后无法得到响应，需要设置一个合适的超时时间
  
### 消息投递语义(QoS)
- 最多一次(At Most Once)：不关注是否得到远程节点的响应
- 最少一次(At Least Once)：不仅引入超时重试，还要关心每一次的响应，可能造成消息的重复
- 正好一次(Exactly Once)：一般在接收端通过**唯一key**或者**重入幂等**的方式对消息去重，正好一次使得消费者无需考虑重复

### 投递顺序
- 解决顺序不一致问题，常用序列号或者状态机
- 序列号：比如忽略过期消息或者阻塞保证序列号递增
- 状态机：消息能改变资源的状态，可以规定状态的迁移方向

### 常用协议
- AMQP(Advanced Message Queuing Protocol)协议
  - 规定了队列、路由、可用性、安全性等方面的内容
  - StormMQ RabbitMQ都实现了AMQP
  - RabbitMQ支持最多一次和最少一次
- MQTT(Message Queuing Telemetry Transport，消息队列遥测传输)
  - 建立在TCP/IP协议智商，支持3中不同的服务质量级别(QoS)

### 消息
- 两次RPC加一次转储，如果需要消费端确认则是三次RPC
#### 使用场景
- 解耦
- 最终一致性
- 广播
- 错峰与流控
#### 设计
- 消息转储，在更合适的时间点投递，或者通过一系列手段辅助消息最终能送达消费机
- 规范一种范式和通用模式，以满足解耦、最终一致性、错峰等需求
#### 基本功能
- RPC通信协议，比如Thrift Dubbo设置用Redis实现
- 高可用
